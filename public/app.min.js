"use strict";function lastfmUserService(t,e){}var app=angular.module("Scrbbl",["ngCookies","ngResource","ngMessages","ngRoute","mgcrea.ngStrap"]);app.config(["$locationProvider","$routeProvider",function(t,e){t.html5Mode(!0),e.when("/",{templateUrl:"public/views/home.html",controller:"MainCtrl"}).when("/manual",{templateUrl:"public/views/manual.html",controller:"ManualCtrl"}).when("/scrobblealbum",{templateUrl:"public/views/scrobblealbum.html",controller:"ScrobbleAlbumCtrl"}).when("/scrobbleradio",{templateUrl:"public/views/scrobbleradio.html",controller:"RadioCtrl"}).when("/scrobbleuser",{templaterUrl:"public/views/scrobbleuser.html",controller:"UserCtrl"}).otherwise({redirectTo:"/"})}]),function(){angular.module("Scrbbl").factory("Authenticate",["$http","$window","$location",function(t,e,r){function o(){var t=r.absUrl().split("?")[0];return e.location.href="http://www.last.fm/api/auth/?api_key=f4f831e3766b42660d26c9b29b25599e&cb="+t}function n(e){return t.get("/api/auth/"+e)}return{login:o,createSession:n}}])}(),angular.module("Scrbbl").factory("lastfmUser",["$http","$q",lastfmUserService]),function(){angular.module("Scrbbl").factory("Radio",["$http","$window","$q",function(t,e,r){function o(e){return t.get("/api/radio/getstationplays/"+e).then(function(t){return t.data.recenttracks.track}).catch(function(t){r.reject("Error retrieving station plays - (HTTP Status: "+t.status+")")})}return{getStationPlays:o}}])}(),function(){angular.module("Scrbbl").factory("Scrobble",["$http","$window","$q","UserPersistence",function(t,e,r,o){function n(e){return t.post("/api/scrobble",e)}function a(e){return t.post("/api/searchalbum",e).then(function(t){var e=_.map(t.data.results,function(t){return{title:t.collectionName,artist:t.artistName,collectionId:t.collectionId,imageUrl:t.artworkUrl60}});return e}).catch(function(t){return r.reject("Error searching for albums - (HTTP Status: "+t.status+")")})}function c(e){return t.post("/api/scrobblealbum",e)}function l(t){}function i(){return t({method:"GET",url:encodeURI("api/getartistscrobbles"),headers:{username:s.userName,key:s.key}}).then(function(t){return t.data})}var s=o.getCookieData(),u={};return{scrobbleTrack:n,searchAlbum:a,scrobbleAlbum:c,getArtistScrobbles:l,getUserTopArtists:i,topArtists:u}}])}(),function(){angular.module("Scrbbl").factory("Track",["$http","$window","$q",function(t,e,r){function o(e){return t.get("/api/albums/getalbuminfo/"+e).then(function(t){return t.data}).catch(function(t){return r.reject("Error getting album tracks")})}return{getAlbumTracks:o}}])}(),function(){angular.module("Scrbbl").factory("UserPersistence",["$cookies",function(t){function e(e){a=e.username,c=e.key,t.put("userName",a),t.put("key",c)}function r(){var e={};return e.userName=t.get("userName"),e.key=t.get("key"),e.userName?e:null}function o(){a="",c="",t.remove("userName"),t.remove("key")}function n(){var e=null;return t.get("key")&&(e=t.get("key")),e}var a="",c="";return{setCookieData:e,getCookieData:r,clearCookieData:o,getCookieKey:n}}])}(),angular.module("Scrbbl").controller("ScrobbleAlbumCtrl",["$scope","$alert","Authenticate","$location","Scrobble","UserPersistence","Track",function(t,e,r,o,n,a,c){t.album={},t.selectedAlbum=null,t.search=function(){n.searchAlbum(t.album).then(function(e){t.results=e}).catch(function(t){console.log(t)}).finally(function(){console.log("Complete")})},t.refreshForm=function(){t.success=!1,t.track={}},t.selectResult=function(e){t.selectedAlbum=e,c.getAlbumTracks(e.collectionId).then(function(e){t.album.tracks=e})},t.scrobbleAlbum=function(){t.album.user=a.getCookieData(),n.scrobbleAlbum(t.album).then(function(e){t.success=e,t.loading=!1,t.results={},t.selectedAlbum={},t.album={}})}}]),angular.module("Scrbbl").controller("LoginCtrl",["$scope","$alert","Authenticate","$location","UserPersistence",function(t,e,r,o,n){n.getCookieData()&&(t.user=n.getCookieData());var a=o.search().token;a&&"undefined"!=a&&!n.getCookieData()&&r.createSession(a).then(function(e){t.user={},t.user.username=e.data.username,t.user.key=e.data.key,n.setCookieData(t.user)}),t.authenticate=function(){console.log("clicked"),r.login()},t.logout=function(){n.clearCookieData(),location.reload()}}]),angular.module("Scrbbl").controller("MainCtrl",["$scope","$alert","Authenticate","$location","$cookies","UserPersistence",function(t,e,r,o,n,a){t.showFirstVisitMessage=!n.visited,n.visited="yes"}]),angular.module("Scrbbl").controller("ManualCtrl",["$scope","$alert","Authenticate","$location","Scrobble","UserPersistence",function(t,e,r,o,n,a){a.getCookieData()&&n.getUserTopArtists().then(function(t){n.topArtists=t}),t.track={},t.success=!1,t.scrobble=function(){t.loading=!0,t.track.user=a.getCookieData(),n.scrobbleTrack(t.track).then(function(e){t.success=e,t.loading=!1})},t.refreshForm=function(){t.success=!1,t.track={}},t.$watch("track.songArtist",_.debounce(function(e,r){t.$apply(function(){void 0!==e&&(t.artistScrobbles=_.result(_.find(n.topArtists,function(t){return t.name.toLowerCase()===e.toLowerCase()}),"playcount"),console.log(t.artistScrobbles))})},1e3),!0)}]),angular.module("Scrbbl").controller("RadioCtrl",["$scope","$alert","Authenticate","$location","Scrobble","Radio",function(t,e,r,o,n,a){t.stations=[{station:"Radio 1",lastfmName:"bbcradio1"},{station:"Radio 2",lastfmName:"bbcradio2"},{station:"Radio 3",lastfmName:"bbcradio3"},{station:"Radio 1xtra",lastfmName:"bbc1xtra"}],t.getStationPlays=function(){a.getStationPlays(t.selectedStation).then(function(e){t.results=_.map(e,function(t){return{title:t.name,artist:t.artist["#text"],date:t.date?t.date["#text"]:" "}})}).catch(function(t){console.log("Error message: "+t)})},t.scrobbleSelected=function(){var e=_.filter(t.results,function(t){return t.toScrobble});console.log(e)}}]);